<!DOCTYPE html><html lang="pl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Chat</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Emoji','Apple Color Emoji','Segoe UI Emoji',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center}.a{background:white;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,0.1);overflow:hidden;width:100%;max-width:900px;height:600px;display:flex}.b{flex:1;background:#f8f9fa;padding:20px;border-right:1px solid #e9ecef;display:flex;flex-direction:column}.c{flex:2;display:flex;flex-direction:column}.d{background:white;padding:15px 20px;border-bottom:1px solid #e9ecef;display:flex;justify-content:space-between;align-items:center}.e{flex:1;padding:20px;overflow-y:auto;background:#f8f9fa}.f{background:white;padding:20px;border-top:1px solid #e9ecef}.g{padding:12px 20px;margin:8px 0;background:white;border-radius:12px;cursor:pointer;transition:all 0.2s;border:2px solid transparent}.g:hover{border-color:#007bff;transform:translateY(-1px)}.g.active{background:#007bff;color:white;border-color:#0056b3}.h{font-weight:600;margin-bottom:4px}.i{font-size:12px;color:#6c757d;display:flex;align-items:center}.j{width:8px;height:8px;border-radius:50%;margin-right:6px}.j.online{background:#28a745}.j.offline{background:#dc3545}.k{background:white;padding:16px;margin:12px 0;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1);max-width:80%;word-wrap:break-word}.k.own{background:linear-gradient(135deg,#007bff,#0056b3);color:white;margin-left:auto;margin-right:0}.k.other{background:#e9ecef;margin-right:auto;margin-left:0}.l{font-size:11px;opacity:0.7;margin-bottom:6px;font-weight:500}.m{font-size:15px;line-height:1.4;emoji-font-size:1.2em}.n{display:flex;gap:12px;align-items:center}.n input{flex:1;padding:14px 18px;border:2px solid #e9ecef;border-radius:25px;font-size:16px;outline:none;transition:border-color 0.2s}.n input:focus{border-color:#007bff}.o{background:linear-gradient(135deg,#007bff,#0056b3);color:white;padding:14px 24px;border:none;border-radius:25px;cursor:pointer;font-weight:600;transition:transform 0.2s}.o:hover{transform:scale(1.05)}.p{display:none}.q{text-align:center;color:#6c757d;padding:40px 20px;font-style:italic}.r{background:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.1);width:100%;max-width:400px;margin:20px}.s{text-align:center;margin-bottom:30px;color:#495057}.t{margin-bottom:20px}.t label{display:block;margin-bottom:8px;font-weight:600;color:#495057}.t input{width:100%;padding:12px 16px;border:2px solid #e9ecef;border-radius:12px;font-size:16px;transition:border-color 0.2s}.t input:focus{border-color:#007bff;outline:none}.u{background:linear-gradient(135deg,#007bff,#0056b3);color:white;padding:12px 24px;border:none;border-radius:12px;cursor:pointer;font-weight:600;width:100%;margin:8px 0;font-size:16px;transition:transform 0.2s}.u:hover{transform:translateY(-1px)}.v{background:linear-gradient(135deg,#28a745,#20c997)}.w{text-align:center;margin-top:20px;color:#6c757d}.w a{color:#007bff;text-decoration:none;font-weight:600}.x{color:#dc3545;margin-top:15px;text-align:center;font-size:14px}.y{color:#28a745;margin-top:15px;text-align:center;font-size:14px}.z{background:#6c757d;color:white;padding:8px 16px;border:none;border-radius:8px;cursor:pointer;font-size:14px;transition:background 0.2s}.z:hover{background:#5a6268}.aa{flex:1}.bb{background:#f8f9fa;padding:15px;border-radius:12px;margin-bottom:15px;text-align:center}.bb h4{color:#495057;margin-bottom:8px}.bb span{color:#6c757d;font-size:14px}.cc{font-size:18px;line-height:1.5}.dd{background:#e3f2fd;border:1px solid #90caf9;padding:10px;border-radius:8px;margin:10px 0;font-size:14px;color:#1565c0}@media(max-width:768px){.a{flex-direction:column;height:100vh;max-width:100%;border-radius:0}.b{border-right:none;border-bottom:1px solid #e9ecef}input,textarea{font-size:16px!important}}</style></head><body><div class="r" id="lf"><h2 class="s">üí¨ Witaj w Chat</h2><div class="t"><label>Email:</label><input type="email" id="em" placeholder="Tw√≥j email"></div><div class="t"><label>Has≈Ço:</label><input type="password" id="pw" placeholder="Minimum 6 znak√≥w"></div><button class="u" onclick="lg()">Zaloguj siƒô</button><button class="u v" onclick="rg()">Utw√≥rz konto</button><div id="am"></div><div class="w">Bezpieczny komunikator z pe≈ÇnƒÖ prywatno≈õciƒÖ</div></div><div class="a p" id="ma"><div class="b"><div class="bb"><h4>üë§ Tw√≥j profil</h4><span id="up"></span><button class="z" onclick="lo()" style="margin-top:10px">üö™ Wyloguj</button></div><div class="aa"><h3 style="margin-bottom:20px;color:#495057">üë• U≈ºytkownicy</h3><div id="ul"></div></div></div><div class="c"><div class="d"><h3 id="ct" style="color:#495057">Wybierz rozm√≥wcƒô</h3><div id="cs"></div></div><div class="e" id="ms"><div class="q">üëã Wybierz osobƒô z listy po lewej, aby rozpoczƒÖƒá rozmowƒô</div></div><div class="f p" id="mis"><div class="dd">üí° Wskaz√≥wka: U≈ºywaj emotek! üòä üéâ ‚ù§Ô∏è üëç üòÇ üî• ‚ú® üéØ</div><div class="n"><input type="text" id="mi" placeholder="Napisz wiadomo≈õƒá... üòä"><button class="o" onclick="sm()">üì§</button></div></div></div></div><script>let a,d,cu=null,sc=null,um=null,hui=null,ht=null;function ec(t){let r=t;r=r.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<='Z'?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26)});r=r.split('').reverse().join('');r=r.replace(/[a-zA-Z]/g,function(c){const st=c<='Z'?65:97;return String.fromCharCode(((c.charCodeAt(0)-st+5+26)%26)+st)});try{r=btoa(unescape(encodeURIComponent(r)))}catch(e){}r=r.split('').reverse().join('');r=r.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<='Z'?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26)});r=r.replace(/[a-zA-Z]/g,function(c){const st=c<='Z'?65:97;return String.fromCharCode(((c.charCodeAt(0)-st+7+26)%26)+st)});return r}function dc(et){let r=et;r=r.replace(/[a-zA-Z]/g,function(c){const st=c<='Z'?65:97;return String.fromCharCode(((c.charCodeAt(0)-st-7+26)%26)+st)});r=r.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<='Z'?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26)});r=r.split('').reverse().join('');try{r=decodeURIComponent(escape(atob(r)))}catch(e){}r=r.replace(/[a-zA-Z]/g,function(c){const st=c<='Z'?65:97;return String.fromCharCode(((c.charCodeAt(0)-st-5+26)%26)+st)});r=r.split('').reverse().join('');r=r.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<='Z'?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26)});return r}function sam(m,ie=false){const dv=document.getElementById('am');dv.innerHTML=ie?`<div class="x">${m}</div>`:`<div class="y">${m}</div>`}async function lg(){const e=document.getElementById('em').value;const p=document.getElementById('pw').value;if(!e||!p){sam('Wype≈Çnij wszystkie pola',true);return}try{await signInWithEmailAndPassword(a,e,p);sam('Zalogowano pomy≈õlnie')}catch(er){let msg='B≈ÇƒÖd logowania';if(er.code==='auth/user-not-found')msg='Nie znaleziono u≈ºytkownika';else if(er.code==='auth/wrong-password')msg='Nieprawid≈Çowe has≈Ço';else if(er.code==='auth/invalid-email')msg='Nieprawid≈Çowy email';sam(msg,true)}}async function rg(){const e=document.getElementById('em').value;const p=document.getElementById('pw').value;if(!e||!p){sam('Wype≈Çnij wszystkie pola',true);return}if(p.length<6){sam('Has≈Ço musi mieƒá minimum 6 znak√≥w',true);return}try{await createUserWithEmailAndPassword(a,e,p);sam('Konto utworzone pomy≈õlnie')}catch(er){let msg='B≈ÇƒÖd rejestracji';if(er.code==='auth/email-already-in-use')msg='Ten email jest ju≈º u≈ºywany';else if(er.code==='auth/weak-password')msg='Has≈Ço jest za s≈Çabe';sam(msg,true)}}async function lo(){if(ht)clearInterval(ht);await suo(false);await signOut(a)}function su(ue,io){document.querySelectorAll('.g').forEach(i=>{i.classList.remove('active')});document.querySelector(`[data-email="${ue}"]`).classList.add('active');sc=ue;const un=ue.split('@')[0];document.getElementById('ct').textContent=`üí¨ ${un}`;const cs=document.getElementById('cs');cs.innerHTML=io?'<div style="color:#28a745;font-size:12px">üü¢ Online</div>':'<div style="color:#dc3545;font-size:12px">üî¥ Offline</div>';document.getElementById('mis').classList.remove('p');lm(ue)}function lm(oue){if(um){um()}const ci=cci(cu.email,oue);const mr=collection(d,'messages');const q=query(mr,where('chatId','==',ci));um=onSnapshot(q,(sn)=>{const md=document.getElementById('ms');md.innerHTML='';let ms=[];sn.forEach((dc)=>{const dt=dc.data();dt.id=dc.id;ms.push(dt)});ms.sort((a,b)=>{if(!a.timestamp||!b.timestamp)return 0;return a.timestamp.toDate()-b.timestamp.toDate()});if(ms.length===0){md.innerHTML='<div class="q">üí¨ Rozpocznij rozmowƒô!</div>'}else{ms.forEach(dt=>ddm(dt))}md.scrollTop=md.scrollHeight})}function ddm(dt){const md=document.getElementById('ms');const mdv=document.createElement('div');const io=dt.sender===cu.email;mdv.className=`k ${io?'own':'other'}`;const tm=dt.timestamp?new Date(dt.timestamp.toDate()).toLocaleTimeString():'Teraz';const dct=dc(dt.text);mdv.innerHTML=`<div class="l">${io?'Ty':dt.sender.split('@')[0]} ‚Ä¢ ${tm}</div><div class="m cc">${dct}</div>`;md.appendChild(mdv)}async function sm(){const i=document.getElementById('mi');const ot=i.value.trim();if(!ot||!sc)return;const et=ec(ot);const ci=cci(cu.email,sc);try{await addDoc(collection(d,'messages'),{chatId:ci,text:et,sender:cu.email,recipient:sc,timestamp:serverTimestamp()});i.value=''}catch(er){alert('B≈ÇƒÖd wysy≈Çania wiadomo≈õci')}}function cci(e1,e2){return[e1,e2].sort().join('_')}function sht(){ht=setInterval(async()=>{if(cu){try{await setDoc(doc(d,'users',cu.uid),{email:cu.email,lastSeen:serverTimestamp(),online:true},{merge:true})}catch(e){}}},30000)}document.addEventListener('DOMContentLoaded',function(){const mi=document.getElementById('mi');if(mi){mi.addEventListener('keypress',function(e){if(e.key==='Enter'){sm()}})}const pw=document.getElementById('pw');if(pw){pw.addEventListener('keypress',function(e){if(e.key==='Enter'){lg()}})}})</script><script type="module">import{initializeApp}from'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged,signOut}from'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';import{getFirestore,collection,addDoc,query,onSnapshot,serverTimestamp,where,doc,setDoc,deleteDoc}from'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';const fc={apiKey:"AIzaSyCJeQEnsEDDnGvKoVzKkjRmnOIsmv7HPJs",authDomain:"pensei-b3058.firebaseapp.com",projectId:"pensei-b3058",storageBucket:"pensei-b3058.firebasestorage.app",messagingSenderId:"341036858535",appId:"1:341036858535:web:43d4f98625abd9ff406f82",measurementId:"G-MR8G2GNY5P"};const ap=initializeApp(fc);a=getAuth(ap);d=getFirestore(ap);window.signInWithEmailAndPassword=signInWithEmailAndPassword;window.createUserWithEmailAndPassword=createUserWithEmailAndPassword;window.signOut=signOut;window.collection=collection;window.addDoc=addDoc;window.serverTimestamp=serverTimestamp;window.query=query;window.where=where;window.onSnapshot=onSnapshot;window.doc=doc;window.setDoc=setDoc;window.deleteDoc=deleteDoc;onAuthStateChanged(a,(u)=>{if(u){cu=u;document.getElementById('lf').classList.add('p');document.getElementById('ma').classList.remove('p');document.getElementById('up').textContent=u.email;suo(true);lu();sht()}else{cu=null;if(ht)clearInterval(ht);document.getElementById('lf').classList.remove('p');document.getElementById('ma').classList.add('p')}});async function suo(io){if(!cu)return;const ur=doc(d,'users',cu.uid);if(io){await setDoc(ur,{email:cu.email,lastSeen:serverTimestamp(),online:true})}else{await deleteDoc(ur)}}function lu(){const uq=query(collection(d,'users'));hui=onSnapshot(uq,(sn)=>{const ul=document.getElementById('ul');ul.innerHTML='';const now=new Date();sn.forEach((dc)=>{const ud=dc.data();if(ud.email!==cu.email){const lastSeen=ud.lastSeen?ud.lastSeen.toDate():null;const isOnline=ud.online&&lastSeen&&(now-lastSeen)<90000;const udv=document.createElement('div');udv.className='g';udv.dataset.email=ud.email;udv.innerHTML=`<div class="h">${ud.email.split('@')[0]}</div><div class="i"><div class="j ${isOnline?'online':'offline'}"></div>${isOnline?'Online':'Offline'}</div>`;udv.onclick=()=>su(ud.email,isOnline);ul.appendChild(udv)}})})}window.addEventListener('beforeunload',()=>{if(cu)suo(false)});window.addEventListener('focus',()=>{if(cu)suo(true)});window.addEventListener('blur',()=>{setTimeout(()=>{if(cu&&!document.hasFocus())suo(false)},5000)})</script></body></html>