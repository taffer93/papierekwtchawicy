<!DOCTYPE html><html lang="pl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Chat</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center}.a{background:white;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,0.1);overflow:hidden;width:100%;max-width:900px;height:600px;display:flex}.b{flex:1;background:#f8f9fa;padding:20px;border-right:1px solid #e9ecef}.c{flex:2;display:flex;flex-direction:column}.d{background:white;padding:20px;border-bottom:1px solid #e9ecef}.e{flex:1;padding:20px;overflow-y:auto;background:#f8f9fa}.f{background:white;padding:20px;border-top:1px solid #e9ecef}.g{padding:12px 20px;margin:8px 0;background:white;border-radius:12px;cursor:pointer;transition:all 0.2s;border:2px solid transparent}.g:hover{border-color:#007bff;transform:translateY(-1px)}.g.active{background:#007bff;color:white;border-color:#0056b3}.h{font-weight:600;margin-bottom:4px}.i{font-size:12px;color:#6c757d;display:flex;align-items:center}.j{width:8px;height:8px;background:#28a745;border-radius:50%;margin-right:6px}.k{background:white;padding:16px;margin:12px 0;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1);max-width:80%}.k.own{background:linear-gradient(135deg,#007bff,#0056b3);color:white;margin-left:auto;margin-right:0}.k.other{background:#e9ecef;margin-right:auto;margin-left:0}.l{font-size:11px;opacity:0.7;margin-bottom:6px;font-weight:500}.m{font-size:15px;line-height:1.4}.n{display:flex;gap:12px;align-items:center}.n input{flex:1;padding:14px 18px;border:2px solid #e9ecef;border-radius:25px;font-size:16px;outline:none;transition:border-color 0.2s}.n input:focus{border-color:#007bff}.o{background:linear-gradient(135deg,#007bff,#0056b3);color:white;padding:14px 24px;border:none;border-radius:25px;cursor:pointer;font-weight:600;transition:transform 0.2s}.o:hover{transform:scale(1.05)}.p{display:none}.q{text-align:center;color:#6c757d;padding:40px 20px;font-style:italic}.r{background:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.1);width:100%;max-width:400px;margin:20px}.s{text-align:center;margin-bottom:30px;color:#495057}.t{margin-bottom:20px}.t label{display:block;margin-bottom:8px;font-weight:600;color:#495057}.t input{width:100%;padding:12px 16px;border:2px solid #e9ecef;border-radius:12px;font-size:16px;transition:border-color 0.2s}.t input:focus{border-color:#007bff;outline:none}.u{background:linear-gradient(135deg,#007bff,#0056b3);color:white;padding:12px 24px;border:none;border-radius:12px;cursor:pointer;font-weight:600;width:100%;margin:8px 0;font-size:16px;transition:transform 0.2s}.u:hover{transform:translateY(-1px)}.v{background:linear-gradient(135deg,#28a745,#20c997)}.w{text-align:center;margin-top:20px;color:#6c757d}.w a{color:#007bff;text-decoration:none;font-weight:600}.x{color:#dc3545;margin-top:15px;text-align:center;font-size:14px}.y{color:#28a745;margin-top:15px;text-align:center;font-size:14px}@media(max-width:768px){.a{flex-direction:column;height:100vh;max-width:100%;border-radius:0}.b{border-right:none;border-bottom:1px solid #e9ecef}}</style></head><body><div class="r" id="lf"><h2 class="s">ðŸ’¬ Witaj w Chat</h2><div class="t"><label>Email:</label><input type="email" id="em" placeholder="TwÃ³j email"></div><div class="t"><label>HasÅ‚o:</label><input type="password" id="pw" placeholder="Minimum 6 znakÃ³w"></div><button class="u" onclick="lg()">Zaloguj siÄ™</button><button class="u v" onclick="rg()">UtwÃ³rz konto</button><div id="am"></div><div class="w">Bezpieczny komunikator z peÅ‚nÄ… prywatnoÅ›ciÄ…</div></div><div class="a p" id="ma"><div class="b"><h3 style="margin-bottom:20px;color:#495057">ðŸ‘¥ Online</h3><div id="ul"></div></div><div class="c"><div class="d"><h3 id="ct" style="color:#495057">Wybierz rozmÃ³wcÄ™</h3></div><div class="e" id="ms"><div class="q">ðŸ‘‹ Wybierz osobÄ™ z listy po lewej, aby rozpoczÄ…Ä‡ rozmowÄ™</div></div><div class="f p" id="mis"><div class="n"><input type="text" id="mi" placeholder="Napisz wiadomoÅ›Ä‡..."><button class="o" onclick="sm()">ðŸ“¤</button></div></div></div></div><script>let a,d,cu=null,sc=null,um=null;function ec(t){let r=t;r=r.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<='Z'?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26)});r=r.split('').reverse().join('');r=r.replace(/[a-zA-Z]/g,function(c){const st=c<='Z'?65:97;return String.fromCharCode(((c.charCodeAt(0)-st+5+26)%26)+st)});try{r=btoa(unescape(encodeURIComponent(r)))}catch(e){}r=r.split('').reverse().join('');r=r.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<='Z'?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26)});r=r.replace(/[a-zA-Z]/g,function(c){const st=c<='Z'?65:97;return String.fromCharCode(((c.charCodeAt(0)-st+7+26)%26)+st)});return r}function dc(et){let r=et;r=r.replace(/[a-zA-Z]/g,function(c){const st=c<='Z'?65:97;return String.fromCharCode(((c.charCodeAt(0)-st-7+26)%26)+st)});r=r.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<='Z'?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26)});r=r.split('').reverse().join('');try{r=decodeURIComponent(escape(atob(r)))}catch(e){}r=r.replace(/[a-zA-Z]/g,function(c){const st=c<='Z'?65:97;return String.fromCharCode(((c.charCodeAt(0)-st-5+26)%26)+st)});r=r.split('').reverse().join('');r=r.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<='Z'?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26)});return r}function sam(m,ie=false){const dv=document.getElementById('am');dv.innerHTML=ie?`<div class="x">${m}</div>`:`<div class="y">${m}</div>`}async function lg(){const e=document.getElementById('em').value;const p=document.getElementById('pw').value;if(!e||!p){sam('WypeÅ‚nij wszystkie pola',true);return}try{await signInWithEmailAndPassword(a,e,p);sam('Zalogowano pomyÅ›lnie')}catch(er){let msg='BÅ‚Ä…d logowania';if(er.code==='auth/user-not-found')msg='Nie znaleziono uÅ¼ytkownika';else if(er.code==='auth/wrong-password')msg='NieprawidÅ‚owe hasÅ‚o';else if(er.code==='auth/invalid-email')msg='NieprawidÅ‚owy email';sam(msg,true)}}async function rg(){const e=document.getElementById('em').value;const p=document.getElementById('pw').value;if(!e||!p){sam('WypeÅ‚nij wszystkie pola',true);return}if(p.length<6){sam('HasÅ‚o musi mieÄ‡ minimum 6 znakÃ³w',true);return}try{await createUserWithEmailAndPassword(a,e,p);sam('Konto utworzone pomyÅ›lnie')}catch(er){let msg='BÅ‚Ä…d rejestracji';if(er.code==='auth/email-already-in-use')msg='Ten email jest juÅ¼ uÅ¼ywany';else if(er.code==='auth/weak-password')msg='HasÅ‚o jest za sÅ‚abe';sam(msg,true)}}async function lo(){await signOut(a)}function su(ue){document.querySelectorAll('.g').forEach(i=>{i.classList.remove('active')});document.querySelector(`[data-email="${ue}"]`).classList.add('active');sc=ue;document.getElementById('ct').textContent=ue.split('@')[0];document.getElementById('mis').classList.remove('p');lm(ue)}function lm(oue){if(um){um()}const ci=cci(cu.email,oue);const mr=collection(d,'messages');const q=query(mr,where('chatId','==',ci));um=onSnapshot(q,(sn)=>{const md=document.getElementById('ms');md.innerHTML='';let ms=[];sn.forEach((dc)=>{const dt=dc.data();dt.id=dc.id;ms.push(dt)});ms.sort((a,b)=>{if(!a.timestamp||!b.timestamp)return 0;return a.timestamp.toDate()-b.timestamp.toDate()});if(ms.length===0){md.innerHTML='<div class="q">ðŸ’¬ Rozpocznij rozmowÄ™!</div>'}else{ms.forEach(dt=>ddm(dt))}md.scrollTop=md.scrollHeight})}function ddm(dt){const md=document.getElementById('ms');const mdv=document.createElement('div');const io=dt.sender===cu.email;mdv.className=`k ${io?'own':'other'}`;const tm=dt.timestamp?new Date(dt.timestamp.toDate()).toLocaleTimeString():'Teraz';const dct=dc(dt.text);mdv.innerHTML=`<div class="l">${io?'Ty':dt.sender.split('@')[0]} â€¢ ${tm}</div><div class="m">${dct}</div>`;md.appendChild(mdv)}async function sm(){const i=document.getElementById('mi');const ot=i.value.trim();if(!ot||!sc)return;const et=ec(ot);const ci=cci(cu.email,sc);try{await addDoc(collection(d,'messages'),{chatId:ci,text:et,sender:cu.email,recipient:sc,timestamp:serverTimestamp()});i.value=''}catch(er){alert('BÅ‚Ä…d wysyÅ‚ania wiadomoÅ›ci')}}function cci(e1,e2){return[e1,e2].sort().join('_')}document.addEventListener('DOMContentLoaded',function(){const mi=document.getElementById('mi');if(mi){mi.addEventListener('keypress',function(e){if(e.key==='Enter'){sm()}})}const pw=document.getElementById('pw');if(pw){pw.addEventListener('keypress',function(e){if(e.key==='Enter'){lg()}})}})</script><script type="module">import{initializeApp}from'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged,signOut}from'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';import{getFirestore,collection,addDoc,query,onSnapshot,serverTimestamp,where,doc,setDoc,deleteDoc}from'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';const fc={apiKey:"AIzaSyCJeQEnsEDDnGvKoVzKkjRmnOIsmv7HPJs",authDomain:"pensei-b3058.firebaseapp.com",projectId:"pensei-b3058",storageBucket:"pensei-b3058.firebasestorage.app",messagingSenderId:"341036858535",appId:"1:341036858535:web:43d4f98625abd9ff406f82",measurementId:"G-MR8G2GNY5P"};const ap=initializeApp(fc);a=getAuth(ap);d=getFirestore(ap);window.signInWithEmailAndPassword=signInWithEmailAndPassword;window.createUserWithEmailAndPassword=createUserWithEmailAndPassword;window.signOut=signOut;window.collection=collection;window.addDoc=addDoc;window.serverTimestamp=serverTimestamp;window.query=query;window.where=where;window.onSnapshot=onSnapshot;window.doc=doc;window.setDoc=setDoc;window.deleteDoc=deleteDoc;onAuthStateChanged(a,(u)=>{if(u){cu=u;document.getElementById('lf').classList.add('p');document.getElementById('ma').classList.remove('p');suo(true);lu()}else{cu=null;document.getElementById('lf').classList.remove('p');document.getElementById('ma').classList.add('p')}});async function suo(io){if(!cu)return;const ur=doc(d,'users',cu.uid);if(io){await setDoc(ur,{email:cu.email,lastSeen:serverTimestamp(),online:true})}else{await deleteDoc(ur)}}function lu(){const uq=query(collection(d,'users'));onSnapshot(uq,(sn)=>{const ul=document.getElementById('ul');ul.innerHTML='';let c=0;sn.forEach((dc)=>{const ud=dc.data();if(ud.email!==cu.email){const udv=document.createElement('div');udv.className='g';udv.dataset.email=ud.email;udv.innerHTML=`<div class="h">${ud.email.split('@')[0]}</div><div class="i"><div class="j"></div>Online</div>`;udv.onclick=()=>su(ud.email);ul.appendChild(udv);c++}});if(c===0){ul.innerHTML='<div class="q">Brak uÅ¼ytkownikÃ³w online</div>'}})}window.addEventListener('beforeunload',()=>{if(cu)suo(false)})</script></body></html>